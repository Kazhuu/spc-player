(this["webpackJsonpfrontend-web"]=this["webpackJsonpfrontend-web"]||[]).push([[0],{28:function(e,t,r){},38:function(e,t,r){},46:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),i=r(15),s=r.n(i),c=r(27),u=r(4),o=r.n(u),f=r(9),h=r(13),l=(r(38),r(28),r(76)),d=r(47),b=r(77),p=r(2);function v(e){var t=e.fileCallback,r=Object(n.useRef)(null);return Object(p.jsxs)(d.a,{variant:"contained",color:"primary",component:"label",disableElevation:!0,children:["Choose Files",Object(p.jsx)("input",{type:"file",onChange:function(e){if(e.preventDefault(),null!==r&&null!==r.current&&null!==r.current.files){for(var n=[],a=0;a<r.current.files.length;a++){var i=r.current.files.item(a);i&&n.push(i)}t(n)}},ref:r,hidden:!0,multiple:!0})]})}var j=r(71),x=r(75),m=r(74),O=r(70),g=r(72),k=r(73),w=r(78);function y(e){var t=e.spcReaderList,r=e.playingSongName,n=e.showProgress,a=e.progress,i=e.playCallback;return Object(p.jsx)(O.a,{children:Object(p.jsxs)(j.a,{children:[Object(p.jsx)(g.a,{children:Object(p.jsxs)(k.a,{children:[Object(p.jsx)(m.a,{children:"Game"}),Object(p.jsx)(m.a,{children:"Name"}),Object(p.jsx)(m.a,{children:"Artist"}),Object(p.jsx)(m.a,{children:"Comments"}),Object(p.jsx)(m.a,{children:"Length"})]})}),Object(p.jsx)(x.a,{children:Object.keys(t).map((function(e){return r===e&&n?Object(p.jsx)(k.a,{children:Object(p.jsx)(m.a,{colSpan:5,children:Object(p.jsx)(w.a,{variant:"determinate",value:a})})},e):t[e].hasID666Metadata?Object(p.jsxs)(k.a,{hover:!0,selected:r===e,onClick:function(){return i(t[e])},children:[Object(p.jsx)(m.a,{children:t[e].metadata.game}),Object(p.jsx)(m.a,{children:e}),Object(p.jsx)(m.a,{children:t[e].metadata.artist}),Object(p.jsx)(m.a,{children:t[e].metadata.comments}),Object(p.jsx)(m.a,{children:t[e].metadata.length})]},e):Object(p.jsxs)(k.a,{hover:!0,selected:r===e,onClick:function(){return i(t[e])},children:[Object(p.jsx)(m.a,{}),Object(p.jsx)(m.a,{children:e}),Object(p.jsx)(m.a,{}),Object(p.jsx)(m.a,{}),Object(p.jsx)(m.a,{})]},e)}))})]})})}var S,P=r(16),C=r(17),R=function(){function e(t){Object(P.a)(this,e),this.device=void 0,this.interfaceNumber=void 0,this.endpointIn=void 0,this.endpointOut=void 0,this.device=t}return Object(C.a)(e,[{key:"connect",value:function(){var e=Object(f.a)(o.a.mark((function e(){var t=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.device.open();case 2:if(null!==this.device.configuration){e.next=5;break}return e.next=5,this.device.selectConfiguration(1);case 5:return this.device.configuration.interfaces.forEach((function(e){e.alternates.forEach((function(r){255===r.interfaceClass&&(t.interfaceNumber=e.interfaceNumber,r.endpoints.forEach((function(e){"out"===e.direction&&(t.endpointOut=e.endpointNumber),"in"===e.direction&&(t.endpointIn=e.endpointNumber)})))}))})),e.next=9,this.device.claimInterface(this.interfaceNumber);case 9:return e.next=11,this.device.selectAlternateInterface(this.interfaceNumber,0);case 11:return e.next=13,this.device.controlTransferOut({requestType:"class",recipient:"interface",request:34,value:1,index:this.interfaceNumber});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(e){return this.device.transferOut(this.endpointOut,e)}},{key:"read",value:function(e){return this.device.transferIn(this.endpointIn,e)}},{key:"reset",value:function(){var e=Object(f.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.device.reset();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){var e=Object(f.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.device.controlTransferOut({requestType:"class",recipient:"interface",request:34,value:0,index:this.interfaceNumber});case 2:return e.next=4,this.device.close();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function T(e){var t=Object(n.useState)(!1),r=Object(h.a)(t,2),a=r[0],i=r[1],s=Object(n.useState)("Device disconnected"),c=Object(h.a)(s,2),u=c[0],l=c[1];function b(){return(b=Object(f.a)(o.a.mark((function t(){var r,n,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a){t.next=18;break}return r=[{vendorId:9025}],t.next=4,navigator.usb.requestDevice({filters:r});case 4:return n=t.sent,i(!0),s=new R(n),t.prev=7,t.next=10,s.connect();case 10:l("Device connected"),i(!0),e.connectCallback(s),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),l(t.t0.toString());case 18:case"end":return t.stop()}}),t,null,[[7,15]])})))).apply(this,arguments)}return Object(n.useEffect)((function(){function t(){return(t=Object(f.a)(o.a.mark((function t(){var r,n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.usb.getDevices();case 2:if(!((r=t.sent).length>0)){t.next=20;break}return n=new R(r[0]),t.prev=5,t.next=8,n.connect();case 8:return t.next=10,n.reset();case 10:l("Device connected"),i(!0),e.connectCallback(n),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(5),l(t.t0.toString());case 18:t.next=21;break;case 20:i(!1);case 21:case"end":return t.stop()}}),t,null,[[5,15]])})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[]),Object(p.jsxs)("div",{children:[Object(p.jsx)(d.a,{onClick:function(){return b.apply(this,arguments)},variant:"contained",color:"primary",disableElevation:!0,children:"Connect"}),Object(p.jsxs)("label",{className:"App-label",children:["Status: ",u]})]})}!function(e){e[e.Unknown=0]="Unknown",e[e.ZSNES=1]="ZSNES",e[e.Snes9x=2]="Snes9x"}(S||(S={}));var D=function(){function e(t,r){Object(P.a)(this,e),this.filename=void 0,this.programCounter=void 0,this.a=void 0,this.x=void 0,this.y=void 0,this.programStatusWord=void 0,this.stackPointer=void 0,this.hasID666Metadata=void 0,this.metadata=void 0,this.dspRegisters=void 0,this.ram=void 0,this.firstPageRam=void 0,this.secondPageRam=void 0,this.restOfTheRam=void 0,this.buffer=void 0,this.filename=t,this.buffer=new Uint8Array(r),this.parse()}return Object(C.a)(e,[{key:"name",value:function(){return this.hasID666Metadata?this.metadata.title:this.filename}},{key:"title",value:function(){return this.hasID666Metadata?"".concat(this.metadata.game," - ").concat(this.metadata.title):"".concat(this.name())}},{key:"songLengthInMs",value:function(){return this.hasID666Metadata?1e3*this.metadata.length:6e4}},{key:"parse",value:function(){if(!this.verify())throw new Error("Not a valid SPC file");this.parseSPCInfo(),this.hasID666Metadata&&this.parseID666(),this.dspRegisters=this.buffer.slice(65792,65920),this.ram=this.buffer.slice(256,65792),this.firstPageRam=this.ram.slice(0,256),this.secondPageRam=this.ram.slice(256,512),this.restOfTheRam=this.ram.slice(512,65472)}},{key:"verify",value:function(){return"SNES-SPC700 Sound File Data v0.30"===this.bufferToString(0,33)&&26===this.buffer[33]&&26===this.buffer[34]}},{key:"parseSPCInfo",value:function(){this.hasID666Metadata=26===this.buffer[35],this.a=this.buffer[39],this.x=this.buffer[40],this.y=this.buffer[41],this.programStatusWord=this.buffer[42],this.stackPointer=this.buffer[43],this.programCounter=this.buffer.slice(37,39)}},{key:"parseID666",value:function(){this.metadata={title:this.bufferToString(46,32),game:this.bufferToString(78,32),dumpedBy:this.bufferToString(110,16),comments:this.bufferToString(126,32),dumpedOn:new Date(this.bufferToString(158,11)),length:Number(this.bufferToString(169,3)),fadeOutLength:Number(this.bufferToString(172,4)),artist:this.bufferToString(177,32),defaultChannelDisabled:1===this.buffer[209],emulator:Number(this.bufferToString(210,1))}}},{key:"bufferToString",value:function(e,t){return new TextDecoder("utf-8").decode(this.buffer.slice(e,e+t)).replace(/\0/g,"")}}]),e}(),N=1015,I=function(){function e(t){Object(P.a)(this,e),this.serial=void 0,this.encoder=void 0,this.decoder=void 0,this.serial=t,this.encoder=new TextEncoder,this.decoder=new TextDecoder}return Object(C.a)(e,[{key:"writeCpuRegisters",value:function(){var e=Object(f.a)(o.a.mark((function e(t,r,n,a,i,s){var c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(2===t.length){e.next=2;break}return e.abrupt("return",Promise.reject("Parameter programCounter length must be 2"));case 2:return e.next=4,this.serial.write(this.encode("C"));case 4:return e.next=6,this.serial.write(t);case 6:return e.next=8,this.serial.write(this.numberToByte(r));case 8:return e.next=10,this.serial.write(this.numberToByte(n));case 10:return e.next=12,this.serial.write(this.numberToByte(a));case 12:return e.next=14,this.serial.write(this.numberToByte(i));case 14:return e.next=16,this.serial.write(this.numberToByte(s));case 16:return e.next=18,this.serial.read(1);case 18:if(!(c=e.sent).data||"1"===this.decode(c.data.buffer)){e.next=21;break}return e.abrupt("return",Promise.reject("Writing CPU registers failed"));case 21:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i,s){return e.apply(this,arguments)}}()},{key:"writeDspRegisters",value:function(){var e=Object(f.a)(o.a.mark((function e(t){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(128===t.length){e.next=2;break}return e.abrupt("return",Promise.reject("DSP requires 128 register values"));case 2:return e.next=4,this.serial.write(this.encode("D"));case 4:return e.next=6,this.serial.write(t);case 6:return e.next=8,this.serial.read(1);case 8:if(!(r=e.sent).data||"1"===this.decode(r.data.buffer)){e.next=11;break}return e.abrupt("return",Promise.reject("Writing DSP registers failed"));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"writeFirstPageRam",value:function(){var e=Object(f.a)(o.a.mark((function e(t){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(256===t.length){e.next=2;break}return e.abrupt("return",Promise.reject("First page of the SPC ram requires 256 bytes"));case 2:return e.next=4,this.serial.write(this.encode("0"));case 4:return e.next=6,this.serial.write(t);case 6:return e.next=8,this.serial.read(1);case 8:if(!(r=e.sent).data||"1"===this.decode(r.data.buffer)){e.next=11;break}return e.abrupt("return",Promise.reject("Writing first page ram failed"));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"writeSecondPageRam",value:function(){var e=Object(f.a)(o.a.mark((function e(t){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(256===t.length){e.next=2;break}return e.abrupt("return",Promise.reject("Second page of the SPC ram requires 256 bytes"));case 2:return e.next=4,this.serial.write(this.encode("1"));case 4:return e.next=6,this.serial.write(t);case 6:return e.next=8,this.serial.read(1);case 8:if(!(r=e.sent).data||"1"===this.decode(r.data.buffer)){e.next=11;break}return e.abrupt("return",Promise.reject("Writing second page ram failed"));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"writeRestOfTheRam",value:function(){var e=Object(f.a)(o.a.mark((function e(t,r){var n,a,i,s,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(64960===t.length){e.next=2;break}return e.abrupt("return",Promise.reject("Rest of the SPC ram requires 64960 bytes"));case 2:return n=t.length/N,e.next=5,this.serial.write(this.encode("2"));case 5:a=0;case 6:if(!(a<n)){e.next=21;break}return s=(i=a*N)+N,e.next=11,this.serial.write(t.slice(i,s));case 11:return e.next=13,this.serial.read(1);case 13:if(c=e.sent,r((a+1)/n*100),!c.data||"1"===this.decode(c.data.buffer)){e.next=18;break}return e.abrupt("return",Promise.reject("SPC Ram packet "+a+" transfer failed"));case 18:++a,e.next=6;break;case 21:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"readBootCode",value:function(){var e=Object(f.a)(o.a.mark((function e(){var t,r,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.serial.write(this.encode("B"));case 2:return e.next=4,this.serial.read(1);case 4:if("ok"===(t=e.sent).status){e.next=7;break}return e.abrupt("return",Promise.reject("Reading bootcode size timed out"));case 7:return r=this.byteToNumber(t.data.buffer),e.next=10,this.serial.read(r);case 10:if(n=e.sent,"ok"===t.status){e.next=13;break}return e.abrupt("return",Promise.reject("Reading bootcode timed out"));case 13:return e.abrupt("return",new Uint8Array(n.data.buffer));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"readPorts",value:function(){var e=Object(f.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.serial.write(this.encode("Q"));case 2:return e.next=4,this.serial.read(4);case 4:if("ok"===(t=e.sent).status){e.next=7;break}return e.abrupt("return",Promise.reject("Reading SPC ports timed out"));case 7:return e.abrupt("return",new Uint8Array(t.data.buffer));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"start",value:function(){var e=Object(f.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.serial.write(this.encode("S"));case 2:return e.next=4,this.serial.read(1);case 4:if(!(t=e.sent).data||"1"===this.decode(t.data.buffer)){e.next=7;break}return e.abrupt("return",Promise.reject("Starting SPC execution failed"));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"reset",value:function(){var e=Object(f.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.serial.write(this.encode("R"));case 2:return e.next=4,this.serial.read(1);case 4:if(!(t=e.sent).data||"1"===this.decode(t.data.buffer)){e.next=9;break}return e.next=8,this.serial.reset();case 8:return e.abrupt("return",Promise.reject("SPC reset timed out"));case 9:return e.next=11,this.serial.reset();case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"encode",value:function(e){return this.encoder.encode(e)}},{key:"decode",value:function(e){return this.decoder.decode(e)}},{key:"numberToByte",value:function(e){var t=new ArrayBuffer(1);return new DataView(t).setUint8(0,e),t}},{key:"byteToNumber",value:function(e){return new DataView(e).getUint8(0)}}]),e}();function E(){var e=Object(n.useState)({}),t=Object(h.a)(e,2),r=t[0],a=t[1],i=Object(n.useState)(null),s=Object(h.a)(i,2),u=s[0],j=s[1],x=Object(n.useState)(""),m=Object(h.a)(x,2),O=m[0],g=m[1],k=Object(n.useState)(""),w=Object(h.a)(k,2),S=w[0],P=w[1],C=Object(n.useState)(!1),R=Object(h.a)(C,2),N=R[0],E=R[1],B=Object(n.useState)(0),A=Object(h.a)(B,2),M=A[0],q=A[1],U=Object(n.useState)(null),W=Object(h.a)(U,2),L=W[0],F=W[1];function J(){return(J=Object(f.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},e.next=3,Promise.all(t.map(function(){var e=Object(f.a)(o.a.mark((function e(t){var a,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.arrayBuffer();case 2:a=e.sent,i=new D(t.name,a),r.hasOwnProperty(i.name())||(n[i.name()]=i);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:a((function(e){return Object(c.a)(Object(c.a)({},n),e)}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(){return(V=Object(f.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j(new I(t));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){var t=e.name(),n=Object.entries(r),a=n.findIndex((function(e){var r=Object(h.a)(e,2),n=r[0];r[1];return n===t}));(-1===a||a+1>=n.length)&&(a=-1),F(n[a+1][1])}function z(e){return G.apply(this,arguments)}function G(){return(G=Object(f.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u){e.next=27;break}return e.prev=1,e.next=4,u.reset();case 4:return P(t.name()),E(!0),q(0),e.next=9,u.writeCpuRegisters(t.programCounter,t.a,t.x,t.y,t.stackPointer,t.programStatusWord);case 9:return e.next=11,u.writeDspRegisters(t.dspRegisters);case 11:return e.next=13,u.writeFirstPageRam(t.firstPageRam);case 13:return e.next=15,u.writeSecondPageRam(t.secondPageRam);case 15:return e.next=17,u.writeRestOfTheRam(t.restOfTheRam,(function(e){return q(e)}));case 17:return e.next=19,u.start();case 19:g("Successfully playing: ".concat(t.title())),setTimeout((function(){return Z(t)}),t.songLengthInMs()),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(1),g(e.t0.message);case 26:E(!1);case 27:case"end":return e.stop()}}),e,null,[[1,23]])})))).apply(this,arguments)}return Object(n.useEffect)((function(){L&&(z(L),F(null))}),[L]),Object(p.jsx)("div",{className:"App",children:Object(p.jsx)(l.a,{children:u?Object(p.jsxs)("div",{children:[Object(p.jsxs)("div",{className:"App-connect",children:[Object(p.jsxs)(b.a,{color:"primary","aria-label":"outlined primary button group",children:[Object(p.jsx)(d.a,{onClick:function(){u&&(F(null),u.reset().then((function(){return g("SPC reset was successful")})).catch((function(e){return g(e.message)})))},disableElevation:!0,children:"Reset APU"}),Object(p.jsx)(d.a,{onClick:function(){u&&u.readPorts().then((function(e){g("Reading SPC ports was successful. Check console for the data."),console.log(e)})).catch((function(e){g(e.message)}))},disableElevation:!0,children:"Read Ports"}),Object(p.jsx)(d.a,{onClick:function(){u&&u.readBootCode().then((function(e){var t=[];e.forEach((function(e){t.push(e.toString(16))})),console.log(t),g("Reading bootcode from Arduino was successful. Check console for the data")})).catch((function(e){g(e.message)}))},disableElevation:!0,children:"Read Bootcode"})]}),Object(p.jsx)("label",{className:"App-label",children:O})]}),Object(p.jsx)(v,{fileCallback:function(e){return J.apply(this,arguments)}}),Object(p.jsx)("div",{children:Object(p.jsx)(y,{spcReaderList:r,playCallback:z,playingSongName:S,showProgress:N,progress:M})})]}):Object(p.jsx)("div",{className:"App-connect",children:Object(p.jsx)(T,{connectCallback:function(e){return V.apply(this,arguments)}})})})})}s.a.render(Object(p.jsx)(a.a.StrictMode,{children:Object(p.jsx)(E,{})}),document.getElementById("root"))}},[[46,1,2]]]);
//# sourceMappingURL=main.61311e6a.chunk.js.map